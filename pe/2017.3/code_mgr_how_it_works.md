# How Code Manager works

Under the hood, Code Manager uses r10k and the file sync service to stage, commit, and sync your code, automatically managing your environments and modules.

First, you'll create a control repository with branches for each environment that you want to create \(such as production, development, or testing\). You'll also create a Puppetfile for each of your environments, specifying exactly which modules to install in each environment. This allows Code Manager to create directory environments, based on the branches you've set up. When you push code to your control repo, you'll trigger Code Manager to pull that new code into a staging code directory \(`/etc/puppetlabs/code-staging`\). File sync then picks up those changes, pauses Puppet Server to avoid conflicts, and then syncs the new code to the live code directories on your masters.

For more information about using environments in Puppet, see [About Environments](https://puppet.com/docs/puppet/5.3/environments_about.html).

-   **[Understanding file sync and the staging directory](understand_staging.md)**  
To sync your code across multiple masters and to make sure that code stays consistent, Code Manager relies on file sync and two different code directories: the staging directory and the live code directory.
-   **[Environment isolation metadata and Code Manager](code_mgr_env_isolation.md)**  
Both your live and staging code directories contain metadata files that are generated by file sync to provide environment isolation for your resource types.
-   **[Moving from r10k to Code Manager](move_r10k_to_code_mgr.md)**  
Switching from r10k to Code Manager can improve automation of your code management and deployments, but some r10k users might not be ready to switch yet.

